<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LIVIA åˆ†æå¹³å°</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { background:#111; color:#fff; font-family:Arial; padding:12px; font-size:14px; }
        h2 { margin:10px 0; font-size:18px; }
        select, input, button { width:100%; padding:10px; margin:8px 0; border:1px solid #555; border-radius:6px; background:#222; color:#fff; font-size:14px; }
        button { background:#0af; font-weight:bold; cursor:pointer; }
        button:disabled { background:#555; }
        .error { color:#f66; background:#300; padding:8px; border-radius:6px; margin:8px 0; display:none; }
        #loading, #progressBar, #riskWarning { display:none; margin:8px 0; }
        #progressBar { height:6px; background:#333; border-radius:3px; overflow:hidden; }
        #progressFill { height:100%; width:0%; background:#0af; transition:width .3s; }
        table { width:100%; border-collapse:collapse; margin:10px 0; font-size:12px; }
        th, td { border:1px solid #555; padding:6px; text-align:center; }
        th { background:#222; }
        .whale { background:#ff0; color:#000; }
        .red { color:#f66; } .green { color:#0f0; }
    </style>
</head>
<body>
    <h2>LIVIA åˆ†æå¹³å°</h2>
    <select id="chain">
        <option value="BSC">BSC</option>
        <option value="ETH">ETH</option>
        <option value="Solana">Solana</option>
    </select>
    <input id="address" placeholder="åˆçº¦åœ°å€ (å¦‚ 0x55d398...)">
    <input id="apikey" placeholder="API Key (Solana å¯ç•™ç©º)" type="password">
    <button id="btn">ğŸš€ åˆ†æ</button>

    <div id="error" class="error"></div>
    <div id="loading">åˆ†æä¸­...</div>
    <div id="progressBar"><div id="progressFill"></div></div>
    <div id="riskWarning"></div>
    <div id="result"></div>

    <script>
        const CFG = {
            BSC: { base: "https://api.bscscan.com/api", dec:18, scan:"bscscan.com" },
            ETH: { base: "https://api.etherscan.io/api", dec:18, scan:"etherscan.io" },
            Solana: { base: "https://public-api.solscan.io", dec:9, scan:"solscan.io" }
        };

        document.getElementById('btn').onclick = async () => {
            const chain = document.getElementById('chain').value;
            const addr = document.getElementById('address').value.trim();
            const key = document.getElementById('apikey').value.trim();
            const err = document.getElementById('error');
            const load = document.getElementById('loading');
            const bar = document.getElementById('progressBar');
            const fill = document.getElementById('progressFill');
            const risk = document.getElementById('riskWarning');
            const res = document.getElementById('result');

            err.style.display = 'none'; risk.style.display = 'none'; load.style.display = 'block'; bar.style.display = 'block'; fill.style.width = '10%';
            res.innerHTML = 'è·å–ä¸­...'; document.getElementById('btn').disabled = true;

            if (!addr) { err.textContent = 'è¯·è¾“å…¥åœ°å€'; err.style.display = 'block'; done(); return; }
            if (chain !== 'Solana' && !key) { err.textContent = 'è¯·è¾“å…¥ API Key'; err.style.display = 'block'; done(); return; }

            try {
                const c = CFG[chain];
                let supply = 0;

                // è·å–æ€»ä¾›åº”
                if (chain === 'Solana') {
                    const r = await fetch(`${c.base}/token/meta?tokenAddress=${addr}`);
                    const d = await r.json();
                    supply = d.data ? d.data.supply / (10 ** c.dec) : 0;
                } else {
                    const r = await fetch(`${c.base}?module=stats&action=tokensupply&contractaddress=${addr}&apikey=${key}`);
                    const d = await r.json();
                    supply = d.status === '1' ? d.result / (10 ** c.dec) : 0;
                }
                fill.style.width = '50%';

                // è·å–å‰10æŒæœ‰äºº
                let holders = [];
                if (chain === 'Solana') {
                    const r = await fetch(`${c.base}/token/holders?tokenAddress=${addr}&offset=0&limit=10`);
                    const d = await r.json();
                    holders = d.data ? d.data.map(h => ({a: h.owner, b: h.amount / (10 ** c.dec)})) : [];
                } else {
                    const r = await fetch(`${c.base}?module=token&action=tokenholderlist&contractaddress=${addr}&page=1&offset=10&apikey=${key}`);
                    const d = await r.json();
                    holders = d.status === '1' ? d.result.map(h => ({a: h.TokenHolderAddress, b: parseInt(h.Value) / (10 ** c.dec)})) : [];
                }
                fill.style.width = '100%';

                // æ˜¾ç¤ºè¡¨æ ¼
                if (holders.length && supply > 0) {
                    let html = '<table><tr><th>åœ°å€</th><th>æŒä»“</th><th>å æ¯”</th><th>é²¸é±¼</th></tr>';
                    let top10 = 0;
                    holders.slice(0,10).forEach(h => {
                        const pct = (h.b / supply * 100).toFixed(2);
                        top10 += h.b;
                        const whale = parseFloat(pct) > 1;
                        html += `<tr class="${whale?'whale':''}"><td><a href="https://${c.scan}/address/${h.a}" target="_blank">${h.a.slice(0,6)}...${h.a.slice(-4)}</a></td><td>${h.b.toFixed(0)}</td><td>${pct}%</td><td>${whale?'Yes':''}</td></tr>`;
                    });
                    html += '</table>';
                    res.innerHTML = html;

                    const ratio = (top10 / supply * 100).toFixed(2);
                    if (ratio > 50) {
                        risk.innerHTML = `âš ï¸ å‰10æŒä»“ ${ratio}% - é«˜é£é™©ï¼`;
                        risk.style.display = 'block';
                    }
                } else {
                    res.innerHTML = 'æ— æ•°æ®';
                }
            } catch (e) {
                err.textContent = 'åŠ è½½å¤±è´¥: ' + e.message;
                err.style.display = 'block';
            }
            done();

            function done() {
                load.style.display = 'none'; bar.style.display = 'none'; document.getElementById('btn').disabled = false;
            }
        };
    </script>
</body>
</html>

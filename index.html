<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LIVIA V5 â€” ç™½åº•é»‘å­—ç§»åŠ¨ç‰ˆ</title>
<meta name="description" content="LIVIA V5 â€” Mobile-first DeFi analysis, demo-first.">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#ffffff;
  --card:#f9f9f9;
  --text:#111111;
  --muted:#666666;
  --accent:#00c6ff;
  --accent2:#ff00cc;
  --danger:#ff4d4f;
  --safe:#52c41a;
  --border:#e0e0e0;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,Arial,sans-serif;color:var(--text);background:var(--bg);}
.container{max-width:1100px;margin:0 auto;padding:12px}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px;border-radius:12px;background:var(--card);border:1px solid var(--border);position:sticky;top:0;z-index:30}
.logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
.controls{display:flex;gap:8px;align-items:center}
.input,select,button{padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--text)}
.input::placeholder{color:var(--muted)}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}

.grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
@media(min-width:980px){ .grid{grid-template-columns:320px 1fr 320px} }

.card{background:var(--card);border-radius:12px;padding:12px;border:1px solid var(--border);box-shadow:0 4px 16px rgba(0,0,0,0.08)}
.small{font-size:13px;color:var(--muted)}
.kv{display:flex;justify-content:space-between;align-items:center;gap:10px}
.kv .val{font-weight:700}
.progress{height:6px;background:var(--border);border-radius:6px;overflow:hidden;margin-top:8px}
.progress > div{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s}

/* table */
.table-wrap{max-height:340px;overflow:auto}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px;border-bottom:1px solid var(--border);text-align:center}
th{color:var(--muted);font-weight:700}
.whale{background:rgba(0,198,255,0.12)}
.red{color:var(--danger)}
.green{color:var(--safe)}

/* charts */
.chart-area{display:flex;flex-direction:column;gap:12px}
.chart-card{position:relative;padding:8px;border-radius:10px;background:var(--card)}
.chart-export{position:absolute;right:12px;top:12px;background:var(--accent);border:0;color:#fff;padding:6px 10px;border-radius:8px;cursor:pointer}

/* modal */
#modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;z-index:9999;padding:20px}
.modalCard{max-width:900px;margin:40px auto;background:var(--card);padding:16px;border-radius:10px;border:1px solid var(--border)}
.modalClose{position:absolute;right:24px;top:24px;background:var(--danger);border:0;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}

/* bottom nav */
.bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:var(--card);padding:8px;border-radius:999px;display:flex;gap:8px;border:1px solid var(--border)}
.bottom-nav button{background:transparent;border:0;color:var(--text);padding:8px;border-radius:999px;cursor:pointer}
.tag{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.05);font-size:13px}

</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">LV</div>
    <div class="controls">
      <input id="quick" class="input" placeholder="è¾“å…¥ä»£å¸åæˆ–åˆçº¦">
      <select id="chain" class="input">
        <option value="BSC">BSC</option>
        <option value="ETH">ETH</option>
        <option value="Solana">Solana</option>
      </select>
      <button id="load" class="btn">åŠ è½½åˆ†æ</button>
    </div>
  </div>

  <div class="grid">
    <!-- å·¦æ  -->
    <div>
      <div class="card">
        <div class="small">åˆçº¦åœ°å€</div>
        <input id="contract" class="input" placeholder="ç²˜è´´åˆçº¦åœ°å€">
        <div class="small" style="margin-top:6px">API Keyï¼ˆå¯é€‰ï¼‰</div>
        <input id="apikey" class="input" placeholder="å¯ç•™ç©ºä½¿ç”¨æ¼”ç¤ºæ•°æ®">
        <label style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <input id="forceDemo" type="checkbox"> <span class="small">å¼ºåˆ¶æ¼”ç¤ºæ•°æ®</span>
        </label>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="saveLocal" class="btn-ghost">ä¿å­˜è®¾ç½®</button>
        </div>
        <div id="error" class="small" style="color:var(--danger);margin-top:8px"></div>
      </div>
    </div>

    <!-- ä¸­æ  -->
    <div>
      <div class="card">
        <div style="font-weight:700">æŒä»“ Top 50</div>
        <div class="table-wrap" id="holdersWrap" style="margin-top:8px">
          <div class="small">è¯·å…ˆåŠ è½½æ•°æ®</div>
        </div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="exportCSV" class="btn-ghost">å¯¼å‡º CSV</button>
        </div>
      </div>

      <div class="card chart-area" style="margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">ä»·æ ¼ & æˆäº¤é‡</div>
          <span id="tokenName" class="tag">â€”</span>
        </div>
        <div class="chart-card" style="min-height:220px">
          <button id="exportLine" class="chart-export">å¯¼å‡ºæŠ˜çº¿</button>
          <canvas id="lineChart"></canvas>
        </div>
        <div class="chart-card" style="min-height:200px;margin-top:8px">
          <button id="exportPie" class="chart-export">å¯¼å‡ºåˆ†å¸ƒ</button>
          <canvas id="pieChart"></canvas>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div style="font-weight:700">æœ€è¿‘äº¤æ˜“</div>
        <div id="txs" class="small" style="margin-top:8px">æ— æ•°æ®</div>
      </div>
    </div>

    <!-- å³æ  -->
    <div>
      <div class="card">
        <div style="font-weight:700">é£é™© & å®‰å…¨</div>
        <div id="riskBox" class="small" style="margin-top:8px">åŠ è½½åæ˜¾ç¤º</div>
      </div>
      <div class="card" style="margin-top:12px">
        <div style="font-weight:700">é²¸é±¼ç›‘æ§</div>
        <div id="whales" style="margin-top:8px">è¯·åŠ è½½æ•°æ®</div>
      </div>
    </div>
  </div>

  <div style="height:40px"></div>
</div>

<!-- modal -->
<div id="modal">
  <div class="modalCard">
    <div id="modalContent"></div>
  </div>
  <button id="modalClose" class="modalClose">å…³é—­</button>
</div>

<!-- bottom nav -->
<div class="bottom-nav">
  <button id="navHome">ğŸ </button>
  <button id="navAnalyze">ğŸ“Š</button>
  <button id="navMy">ğŸ‘¤</button>
</div>

<script>
// ç®€å•æ¼”ç¤ºé€»è¾‘ï¼ˆæ¼”ç¤ºæ•°æ®ï¼‰
const qs = id => document.getElementById(id);
const holdersWrap = qs('holdersWrap'), txsEl=qs('txs'), whalesEl=qs('whales'), riskBox=qs('riskBox'), tokenName=qs('tokenName');
const lineCtx = document.getElementById('lineChart').getContext('2d');
const pieCtx = document.getElementById('pieChart').getContext('2d');
let lineChart=null, pieChart=null, lastPayload=null;

// ç”Ÿæˆæ¼”ç¤º holder
function genDemoHolders(n=40){
  const arr=[]; let base=500000;
  for(let i=0;i<n;i++){ base=Math.floor(base*(0.5+Math.random()*0.9)); arr.push({address:'0x'+Math.random().toString(16).slice(2,18)+i.toString(16), balance:base}); }
  arr.sort((a,b)=>b.balance-a.balance); return arr;
}
function demoPayload(){ const holders=genDemoHolders(40); const total=holders.reduce((s,h)=>s+h.balance,0)+300000; const txs=[]; for(let i=0;i<10;i++) txs.push({type:Math.random()>0.5?'Buy':'Sell', amt:(Math.random()*2000).toFixed(2), time:(i+1)+'m ago'}); return {holders,total,txs}; }

// æ¸²æŸ“ holders
function renderHolders(holders,total){
  if(!holders||holders.length===0){ holdersWrap.innerHTML='<div>æ— æŒä»“æ•°æ®</div>'; return; }
  let html='<table><thead><tr><th>åœ°å€</th><th>æŒä»“</th><th>å æ¯”</th><th>é²¸é±¼</th><th>é£é™©</th></tr></thead><tbody>';
  let whaleCount=0;
  holders.slice(0,50).forEach(h=>{
    const ratio=h.balance/total*100;
    const isWhale=ratio>1; if(isWhale) whaleCount++;
    const risk=ratio>50?'é«˜':(ratio>5?'ä¸­':'ä½');
    html+=`<tr class="${isWhale?'whale':''}"><td>${h.address}</td><td>${h.balance.toLocaleString()}</td><td>${ratio.toFixed(2)}%</td><td>${isWhale?'Yes':''}</td><td class="${risk==='é«˜'?'red':'green'}">${risk}</td></tr>`;
  });
  html+='</tbody></table>'; holdersWrap.innerHTML=html;
  whalesEl.innerHTML=`é²¸é±¼æ•°é‡ (>1%): ${whaleCount}`;
  riskBox.innerHTML=`å‰10å æ¯”: ${(holders.slice(0,10).reduce((s,h)=>s+h.balance,0)/total*100).toFixed(2)}%`;
}

// ç»˜åˆ¶å›¾è¡¨
function drawCharts(holders,total){
  const labels=[], data=[]; let p=1+Math.random()*0.2;
  for(let i=6;i>=0;i--){ labels.push('T-'+i); p*=(0.98+Math.random()*0.06); data.push(Number(p.toFixed(3))); }
  if(lineChart) lineChart.destroy();
  lineChart=new Chart(lineCtx,{type:'line',data:{labels,datasets:[{label:'Price',data,borderColor:'#00c6ff',backgroundColor:'rgba(0,198,255,0.1)',tension:0.25}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});
  const top=holders.slice(0,5); const others=holders.slice(5).reduce((s,h)=>s+h.balance,0);
  const labelsPie=top.map(h=>h.address.slice(0,6)+'...').concat(['Others']); const dataPie=top.map(h=>h.balance).concat([others]);
  if(pieChart) pieChart.destroy();
  pieChart=new Chart(pieCtx,{type:'pie',data:{labels:labelsPie,datasets:[{data:dataPie,backgroundColor:['#00c6ff','#ff00cc','#52c41a','#ff9900','#9900ff','#e0e0e0']}]},options:{responsive:true}});
}

// åŠ è½½æ•°æ®æŒ‰é’®
qs('load').onclick=function(){
  const contract=qs('contract').value.trim();
  if(!contract){ qs('error').innerText='è¯·è¾“å…¥åˆçº¦åœ°å€'; return;}
  qs('error').innerText='';
  const payload=demoPayload(); lastPayload=payload;
  tokenName.innerText=contract.slice(0,8)+'...';
  renderHolders(payload.holders,payload.total);
  drawCharts(payload.holders,payload.total);
  txsEl.innerHTML=payload.txs.map(t=>`${t.type} ${t.amt} $`).join('<br>');
}

// å¯¼å‡º CSV
qs('exportCSV').onclick=function(){
  if(!lastPayload){ alert('è¯·å…ˆåŠ è½½æ•°æ®'); return;}
  let csv='åœ°å€,æŒä»“,å æ¯”,é²¸é±¼,é£é™©\n';
  lastPayload.holders.slice(0,50).forEach(h=>{
    const ratio=h.balance/lastPayload.total*100;
    const isWhale=ratio>1?'Yes':'';
    const risk=ratio>50?'é«˜':(ratio>5?'ä¸­':'ä½');
    csv+=`${h.address},${h.balance},${ratio.toFixed(2)}%,${isWhale},${risk}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='holders.csv'; a.click(); URL.revokeObjectURL(url);
}

// modalå…³é—­
qs('modalClose').onclick=function(){ qs('modal').style.display='none'; }
</script>

</body>
</html>
